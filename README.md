# alkir-web-console
Alkir web console - это альтернатива консоли кластера серверов 1С:Предприятия

## Преимущества
 - доступ через web
 - более гранулярная раздача прав
 - мультиплатформенность - поддерживает любую платформу работающую с RAS
 - удобный интерфейс

## Установка
запуск последней стабильной версии
```
docker run dockerhub.alkir.ru/alkir-web-console:main -d -p 8000:8000 --env-file .env --name=alkir-web-console --restart=always alkir-web-rac
```
запуск конкретной версии
```
dockerhub.alkir.ru/alkir-web-console:0-9 -d -p 8000:8000 --env-file .env --name=alkir-web-console --restart=always alkir-web-rac
```

где:
 - -d - запуск в фоновом режиме (отдает управление обратно в консоль)
 - -p - проброс внешних портов внутрь контейнера, чтобы можно было достучаться до приложения внутри. первое значение - порт хоста, второе значение - порт внутри контейнера
 - --restart=always - Всегда перезапускать контейнер, если он остановился. Если он остановлен вручную, то контейнер перезапустится только при перезапуске демона Docker или при перезапуске самого контейнера вручную.
 - --name= - задание имени контейнера
 - --env-file - путь к файлу с переменными окружения. .env приведен в качестве примера, имя может быть любое


## Создание `.env` файла с JSON-структурами

В этом проекте переменные окружения `SETTINGS` и `USER_LIST` содержат сложные JSON-структуры. Такие переменные нельзя сохранять в `.env` файл в многострочном виде, поэтому мы используем **однострочную запись**. Внутри в обязательном порядке должны использоваться двойные кавычки `"`, всю строку надо взять в одинарные кавычки `'`

## Пример `.env` файла

Создай файл `.env` в корне проекта и добавь в него следующее содержимое:

```env
SETTINGS='{"server_list": [{"ras_server": "192.168.217.4"}, {"ras_server": "server", "cluster_admin": "Admin", "cluster_pwd": "123"}, {"ras_server": "172.31.32.4", "ras_port": 1645, "cluster_admin": "test_add1", "cluster_pwd": "123", "ib_name": "test_db"}, {"ras_server": "srv-1c-03"}, {"ras_server": "srv-1c-04"}]}'
USER_LIST='{"user_list": [{"login": "test1", "pwd": "123"}, {"login": "test2", "pwd": "1234"}, {"login": "1", "pwd": "1"}]}'
```
## Описание структуры переменных окружения

### SETTINGS

Переменная `SETTINGS` описывает параметры подключения к RAS-серверу и кластеру 1С. Ниже приведены поля, их назначения и допустимые значения.

| Поле             | Тип     | Обязательное | Описание                                                                                       | Значение по умолчанию |
|------------------|---------|--------------|------------------------------------------------------------------------------------------------|------------------------|
| `ras_server`     | string  | ✅ Да         | Адрес RAS-сервера. Может быть IP-адрес или DNS-имя.                                            | —                      |
| `ras_port`       | int     | ❌ Нет        | Порт подключения к RAS-серверу.                                                                | `1545`                 |
| `timeout`        | int     | ❌ Нет        | Таймаут подключения к серверу в миллисекундах.                                                 | `2000`                 |
| `cluster_admin`  | string  | ❌ Нет        | Имя администратора кластера.                                                                   | `""`                   |
| `cluster_pwd`    | string  | ❌ Нет        | Пароль администратора кластера.                                                                | `""`                   |
| `central_admin`  | string  | ❌ Нет        | Имя администратора центрального кластера (если используется распределённая ИБ).                 | `""`                   |
| `central_pwd`    | string  | ❌ Нет        | Пароль администратора центрального кластера.                                                   | `""`                   |
| `cluster_name`   | string  | ❌ Нет        | Имя кластера. Если на сервере один кластер — заполняется автоматически.                        | `null`                 |
| `cluster_id`     | string  | ❌ Нет        | Уникальный идентификатор кластера. Если кластер один — определяется автоматически.             | `null`                 |

---

### Пример заполнения

```json
{
  "server_list": [
    {"ras_server": "srv-1c-01"},
    {"ras_server": "srv-1c-02", "cluster_admin": "Admin", "cluster_pwd": "123"},
    {"ras_server": "srv-1c-03", "ras_port": 1645, "cluster_admin": "test_add1", "cluster_pwd": "123", "ib_name": "test_db"},
    {"ras_server": "srv-1c-04", "central_admin": "test_add1", "central_pwd": "123"}
  ]
}
```

### USER_LIST
Переменная USER_LIST описывает список пользователей и их учетные данные для доступа.

| Ключ    | Тип    | Описание            |
| ------- | ------ | ------------------- |
| `login` | string | Имя пользователя    |
| `pwd`   | string | Пароль пользователя |


### Пример заполнения

```json
{
  "user_list": [
    {"login": "test1", "pwd": "123"},
    {"login": "test2", "pwd": "1234"},
    {"login": "1", "pwd": "1"}
  ]
}
```